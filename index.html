// =========================
// é¡¹ç›®ç»“æ„ï¼ˆæ‹·è´åˆ°æ–°ä»“åº“æ ¹ç›®å½•ï¼‰
// =========================
// .
// â”œâ”€ app/
// â”‚  â”œâ”€ layout.tsx
// â”‚  â”œâ”€ page.tsx
// â”‚  â”œâ”€ posts/[slug]/page.tsx
// â”‚  â”œâ”€ archive/page.tsx
// â”‚  â”œâ”€ albums/page.tsx
// â”‚  â”œâ”€ moments/page.tsx
// â”‚  â”œâ”€ links/page.tsx
// â”‚  â””â”€ about/page.tsx
// â”œâ”€ components/
// â”‚  â”œâ”€ NavBar.tsx
// â”‚  â”œâ”€ Footer.tsx
// â”‚  â”œâ”€ PostCard.tsx
// â”‚  â””â”€ ThemeToggle.tsx
// â”œâ”€ lib/
// â”‚  â””â”€ posts.ts
// â”œâ”€ content/
// â”‚  â””â”€ posts/*.md
// â”œâ”€ public/
// â”‚  â””â”€ admin/{index.html, config.yml}
// â”œâ”€ styles/globals.css
// â”œâ”€ tailwind.config.ts
// â”œâ”€ postcss.config.js
// â”œâ”€ next.config.ts
// â”œâ”€ package.json
// â”œâ”€ tsconfig.json
// â””â”€ README.md

// =========================
// package.json
// =========================
export default {
  "name": "liuruoxi-blog",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "14.2.5",
    "react": "18.3.1",
    "react-dom": "18.3.1",
    "gray-matter": "4.0.3",
    "remark": "15.0.1",
    "remark-html": "16.0.1",
    "remark-gfm": "4.0.0",
    "clsx": "2.1.1"
  },
  "devDependencies": {
    "autoprefixer": "10.4.19",
    "postcss": "8.4.38",
    "tailwindcss": "3.4.10",
    "typescript": "5.4.5",
    "@types/node": "20.11.30",
    "@types/react": "18.2.66",
    "@types/react-dom": "18.2.22"
  }
}

// =========================
// next.config.ts
// =========================
export const experimental = { mdxRs: true } as const
const nextConfig = { reactStrictMode: true }
export default nextConfig

// =========================
// tailwind.config.ts
// =========================
import type { Config } from 'tailwindcss'
const config: Config = {
  content: ["./app/**/*.{ts,tsx}", "./components/**/*.{ts,tsx}", "./styles/**/*.{css}", "./content/**/*.{md,mdx}"],
  theme: {
    extend: {
      colors: {
        brand: { 50:'#f7f7fb',100:'#eeeef7',200:'#dfdff0',300:'#c7c7e4',400:'#a7a7d5',500:'#7e7ec0',600:'#5b5ba2',700:'#4a4884',800:'#403f6b',900:'#37365a' }
      },
      boxShadow: { soft: '0 6px 24px rgba(0,0,0,0.06)' },
      fontFamily: { sans: ['ui-sans-serif','system-ui','-apple-system','Segoe UI','Noto Sans SC','PingFang SC','Hiragino Sans GB','Microsoft YaHei','Helvetica Neue','Helvetica','Arial'] }
    }
  },
  darkMode: 'class'
}
export default config

// =========================
// postcss.config.js
// =========================
module.exports = { plugins: { tailwindcss: {}, autoprefixer: {} } }

// =========================
// tsconfig.json
// =========================
export default {
  "compilerOptions": {
    "target": "es2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": false,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "types": ["node"]
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}

// =========================
// styles/globals.css
// =========================
@tailwind base;
@tailwind components;
@tailwind utilities;
:root { color-scheme: light dark; }
.prose p { @apply my-3 leading-8; }

// =========================
// components/ThemeToggle.tsx
// =========================
'use client'
import { useEffect, useState } from 'react'
export default function ThemeToggle(){
  const [mounted, setMounted] = useState(false)
  useEffect(()=>{ setMounted(true); if(localStorage.getItem('prefers-dark')==='true'){ document.documentElement.classList.add('dark') } },[])
  if(!mounted) return null
  return (
    <button onClick={()=>{ document.documentElement.classList.toggle('dark'); const v=document.documentElement.classList.contains('dark'); localStorage.setItem('prefers-dark', String(v)) }} className="px-3 py-1 rounded-lg bg-white/10 hover:bg-white/20 transition text-white">
      ğŸŒ— å¤œé—´
    </button>
  )
}

// =========================
// components/NavBar.tsx
// =========================
import Link from 'next/link'
import ThemeToggle from './ThemeToggle'
export default function NavBar(){
  return (
    <header className="border-b border-zinc-200/70 dark:border-zinc-800/80 sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/60 supports-[backdrop-filter]:dark:bg-zinc-950/40">
      <div className="mx-auto max-w-5xl px-4">
        <div className="flex items-center justify-between py-4">
          <Link href="/" className="flex items-center gap-3 group">
            <div className="size-10 rounded-2xl bg-brand-700 text-white grid place-content-center shadow-soft group-hover:rotate-6 transition">æ±</div>
            <div className="leading-tight">
              <div className="text-xl font-semibold bg-gradient-to-r from-fuchsia-500 to-sky-500 bg-clip-text text-transparent">æŸ³è‹¥æ±çš„å°çª</div>
              <div className="text-xs text-zinc-500 dark:text-zinc-400">taozhiruo.com</div>
            </div>
          </Link>
          <nav className="hidden md:flex items-center gap-6 text-sm">
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/">é¦–é¡µ</Link>
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/archive">å½’æ¡£</Link>
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/albums">ç›¸å†Œ</Link>
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/moments">ç¬é—´</Link>
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/links">å‹é“¾</Link>
            <Link className="hover:text-brand-700 dark:hover:text-brand-400" href="/about">å…³äº</Link>
          </nav>
          <div className="md:hidden"></div>
          <ThemeToggle />
        </div>
      </div>
    </header>
  )
}

// =========================
// components/Footer.tsx
// =========================
export default function Footer(){
  return (
    <footer className="border-t border-zinc-200/70 dark:border-zinc-800/80">
      <div className="mx-auto max-w-5xl px-4 py-8 text-sm text-zinc-500 dark:text-zinc-400">
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div>Â© {new Date().getFullYear()} æŸ³è‹¥æ±çš„å°çª Â· taozhiruo.com</div>
          <div className="flex items-center gap-3">
            <a className="hover:underline" href="https://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆå·ï¼šç¤ºä¾‹ICPå¤‡ xxxxxx å·</a>
            <span className="hidden sm:inline">|</span>
            <span className="inline-flex items-center gap-1" title="CDN/ä¿æŠ¤">è…¾è®¯äº‘ EdgeOne</span>
          </div>
        </div>
        <div className="mt-2 text-xs">ä¸ºé˜²èŒƒç”µä¿¡ç½‘ç»œè¯ˆéª—ï¼Œå¦‚æ¥åˆ° 96110 æ¥ç”µè¯·åŠæ—¶æ¥å¬ã€‚</div>
      </div>
    </footer>
  )
}

// =========================
// components/PostCard.tsx
// =========================
import Link from 'next/link'
export default function PostCard({ post }:{ post: any }){
  return (
    <article className="rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden hover:shadow-soft transition">
      <Link href={`/posts/${post.slug}`} className="block p-6">
        <h3 className="text-lg font-semibold">{post.title}</h3>
        <p className="text-zinc-600 dark:text-zinc-300 mt-2 line-clamp-2">{post.excerpt}</p>
        <div className="mt-3 flex flex-wrap items-center gap-3 text-xs text-zinc-500 dark:text-zinc-400">
          <span>ğŸ“… {post.date}</span>
          {post.views ? <span>ğŸ”¥ {post.views}</span> : null}
          {post.comments ? <span>ğŸ’¬ {post.comments}</span> : null}
          {post.tags?.map((t:string)=> (
            <span key={t} className="inline-flex items-center gap-1">ğŸ·ï¸ <span className="px-1.5 py-0.5 rounded bg-zinc-100 dark:bg-zinc-800">{t}</span></span>
          ))}
        </div>
      </Link>
    </article>
  )
}

// =========================
// lib/posts.ts  â€”â€” è¯»å– /content/posts ä¸‹çš„ Markdown
// =========================
import fs from 'node:fs'
import path from 'node:path'
import matter from 'gray-matter'
import { remark } from 'remark'
import html from 'remark-html'
import gfm from 'remark-gfm'

const postsDir = path.join(process.cwd(), 'content', 'posts')

export type PostMeta = { slug:string; title:string; date:string; tags?:string[]; excerpt:string; views?:number; comments?:number; pinned?:boolean }

export function getAllPostSlugs(){
  return fs.readdirSync(postsDir).filter(f=>f.endsWith('.md')).map(f=>f.replace(/\.md$/, ''))
}

export function getAllPosts(): PostMeta[]{
  const slugs = getAllPostSlugs()
  const posts = slugs.map(slug=>{
    const full = fs.readFileSync(path.join(postsDir, slug + '.md'), 'utf8')
    const { data, content } = matter(full)
    return {
      slug,
      title: data.title ?? slug,
      date: data.date ?? '',
      tags: data.tags ?? [],
      excerpt: data.excerpt ?? content.slice(0, 120).replace(/\n/g,' '),
      views: data.views ?? 0,
      comments: data.comments ?? 0,
      pinned: data.pinned ?? false,
    }
  })
  posts.sort((a,b)=> (a.pinned===b.pinned ? 0 : a.pinned? -1:1) || (a.date>b.date? -1:1))
  return posts
}

export async function getPostHtmlBySlug(slug:string){
  const full = fs.readFileSync(path.join(postsDir, slug + '.md'), 'utf8')
  const { data, content } = matter(full)
  const processed = await remark().use(gfm).use(html).process(content)
  return { meta: {
    slug,
    title: data.title ?? slug,
    date: data.date ?? '',
    tags: data.tags ?? [],
  }, html: processed.toString() }
}

// =========================
// app/layout.tsx
// =========================
import './globals.css'
import NavBar from '@/components/NavBar'
import Footer from '@/components/Footer'
export const metadata = {
  title: 'æŸ³è‹¥æ±çš„å°çª â€” æ¸…çˆ½æç®€ä¸»é¢˜',
  description: 'æŸ³è‹¥æ±çš„å°çªï¼šä¸€ä¸ªæ¸…çˆ½ã€æç®€ã€Halo/WordPress/Hexoçš†å¯å¤ç”¨çš„åšå®¢ä¸»é¢˜ã€‚',
  metadataBase: new URL('https://taozhiruo.com'),
  alternates: { canonical: '/' },
  openGraph: { type: 'website', title: 'æŸ³è‹¥æ±çš„å°çª', url: 'https://taozhiruo.com' }
}
export default function RootLayout({ children }:{ children: React.ReactNode }){
  return (
    <html lang="zh-CN" className="scroll-smooth">
      <body className="bg-white text-zinc-900 dark:bg-zinc-950 dark:text-zinc-200">
        <div className="bg-gradient-to-r from-brand-800 to-brand-600 text-white text-sm">
          <div className="mx-auto max-w-5xl px-4 py-2 flex items-center justify-between">
            <div className="truncate">ä¸Šç­å¤šæ‘¸é±¼ï¼Œè€æ¿éª‘ç”µé©´ Â· æŠŠå¹³å‡¡çš„æ—¥å¸¸å†™æˆä¸å‡¡çš„è®°å½•</div>
            {/* å³ä¸Šè§’å¤œé—´åœ¨ Nav å†… */}
          </div>
        </div>
        <NavBar />
        <main className="mx-auto max-w-5xl px-4">{children}</main>
        <Footer />
      </body>
    </html>
  )
}

// =========================
// app/page.tsx  â€”â€” é¦–é¡µï¼ˆåˆ—è¡¨ + åˆ†é¡µç¤ºä¾‹ï¼‰
// =========================
import PostCard from '@/components/PostCard'
import { getAllPosts } from '@/lib/posts'
export const revalidate = 60
export default function Home(){
  const posts = getAllPosts()
  return (
    <section className="py-8 md:py-10">
      <h2 className="text-2xl font-bold">æœ€æ–°æ–‡ç« </h2>
      <p className="text-zinc-500 dark:text-zinc-400 mt-1 text-sm">æ”¯æŒç½®é¡¶ã€æ ‡ç­¾ã€é˜…è¯»æ•°ä¸å‘å¸ƒæ—¥æœŸæ ·å¼ã€‚</p>
      <div className="grid gap-6 mt-6">
        {posts.map(p=> <PostCard key={p.slug} post={p} />)}
      </div>
      {/* è¿™é‡Œå¯æ¥å…¥çœŸæ­£åˆ†é¡µï¼šè¯»å– query å‚æ•° page/size å¹¶ slice */}
      <div className="flex items-center justify-center gap-2 py-6">
        <a className="px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-zinc-100 dark:bg-zinc-900">1</a>
        <a className="px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-900">2</a>
        <a className="px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-900">3</a>
      </div>
    </section>
  )
}

// =========================
// app/posts/[slug]/page.tsx  â€”â€” æ–‡ç« è¯¦æƒ…
// =========================
import { getAllPostSlugs, getPostHtmlBySlug } from '@/lib/posts'
export async function generateStaticParams(){
  return getAllPostSlugs().map(slug=>({ slug }))
}
export default async function PostPage({ params }:{ params:{ slug:string } }){
  const { meta, html } = await getPostHtmlBySlug(params.slug)
  return (
    <article className="prose prose-zinc dark:prose-invert max-w-none py-8">
      <h1 className="bg-gradient-to-r from-fuchsia-500 to-sky-500 bg-clip-text text-transparent font-bold text-3xl">{meta.title}</h1>
      <div className="text-sm text-zinc-500 dark:text-zinc-400">ğŸ“… {meta.date} {meta.tags?.length? ' Â· '+meta.tags.join(' / '): ''}</div>
      <div className="mt-6" dangerouslySetInnerHTML={{ __html: html }} />
    </article>
  )
}

// =========================
// app/archive/page.tsx  â€”â€” å½’æ¡£
// =========================
import { getAllPosts } from '@/lib/posts'
export default function Archive(){
  const posts = getAllPosts()
  const groups = posts.reduce((acc:any,p)=>{ const y=m(p.date); (acc[y]=acc[y]||[]).push(p); return acc },{})
  function m(d:string){ return d?.slice(0,7) || 'æœªçŸ¥' }
  return (
    <section className="pt-10 pb-6">
      <h2 className="text-2xl font-bold">å½’æ¡£</h2>
      <div className="mt-4 grid gap-5">
        {Object.keys(groups).sort((a,b)=>a>b?-1:1).map(k=> (
          <div key={k}>
            <div className="font-medium mb-2">{k}</div>
            <ul className="grid gap-2 text-sm text-zinc-600 dark:text-zinc-300">
              {groups[k].map((p:any)=> (
                <li key={p.slug} className="flex items-center gap-2"><a className="hover:underline" href={`/posts/${p.slug}`}>{p.title}</a> <span className="text-xs">{p.date}</span></li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </section>
  )
}

// =========================
// å…¶å®ƒé¡µï¼šç›¸å†Œ / ç¬é—´ / å‹é“¾ / å…³äºï¼ˆå¯è‡ªå¡«å†…å®¹ï¼‰
// =========================
export function Section({title, children}:{title:string, children:React.ReactNode}){
  return <section className="pt-10 pb-12"><h2 className="text-2xl font-bold">{title}</h2><div className="mt-4 text-zinc-600 dark:text-zinc-300 leading-relaxed">{children}</div></section>
}

// app/albums/page.tsx
import { Section } from '../archive/page'
export default function Albums(){
  return <Section title="ç›¸å†Œ">åœ¨è¿™é‡Œå±•ç¤ºä½ çš„å›¾é›†ï¼ˆä»¥åå¯æ¥å…¥ç›¸å†Œæ•°æ®æºï¼‰ã€‚</Section>
}

// app/moments/page.tsx
import { Section } from '../archive/page'
export default function Moments(){
  return <Section title="ç¬é—´">å‘å¸ƒç®€çŸ­æƒ³æ³•æˆ–æ—¥å¸¸ï¼ˆå¯åšä¸º micro-postsï¼‰ã€‚</Section>
}

// app/links/page.tsx
import { Section } from '../archive/page'
export default function Links(){
  return <Section title="å‹é“¾">æŠŠå‹é“¾æ”¾æˆå¡ç‰‡æˆ–åˆ—è¡¨ï¼Œæ”¯æŒæè¿°ä¸å¤–é“¾ã€‚</Section>
}

// app/about/page.tsx
import { Section } from '../archive/page'
export default function About(){
  return <Section title="å…³äº">è¿™é‡Œæ˜¯ä½ çš„ä¸ªäººåšå®¢ã€‚çƒ­çˆ±è®°å½•ã€åˆ†äº«ä¸åˆ›é€ ï¼Œå¸Œæœ›æ¯ä¸€æ¬¡å‘å¸ƒéƒ½å¸¦æ¥ä¸€ç‚¹å°å°çš„ä»·å€¼ã€‚</Section>
}

// =========================
// public/admin/index.html  â€”â€” Decap CMSï¼ˆåŸ Netlify CMSï¼‰åå°å…¥å£
// =========================
<!doctype html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMS Â· æŸ³è‹¥æ±çš„å°çª</title></head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body></html>

// =========================
// public/admin/config.yml  â€”â€” CMS é…ç½®ï¼ˆGit åç«¯ï¼‰
// ï¼ˆè¯·æŠŠ YOUR_GITHUB_USER ä¸ REPO æ”¹æˆä½ çš„ä»“åº“ã€‚è‹¥éƒ¨ç½²åœ¨ Netlifyï¼Œå¯æ¢ç”¨ git-gateway åç«¯ã€‚ï¼‰
// =========================
backend:
  name: github
  repo: YOUR_GITHUB_USER/YOUR_REPO
  branch: main
  base_url: https://api.github.com
media_folder: "public/uploads"
public_folder: "/uploads"
locale: "zh_Hans"
site_url: "https://taozhiruo.com"
collections:
  - name: "posts"
    label: "æ–‡ç« "
    folder: "content/posts"
    create: true
    slug: "{{year}}-{{month}}-{{day}}-{{slug}}"
    fields:
      - {label: "æ ‡é¢˜", name: "title", widget: "string"}
      - {label: "å‘å¸ƒæ—¥æœŸ", name: "date", widget: "datetime"}
      - {label: "æ ‡ç­¾", name: "tags", widget: "list", default: []}
      - {label: "ç½®é¡¶", name: "pinned", widget: "boolean", default: false}
      - {label: "æ‘˜è¦", name: "excerpt", widget: "text"}
      - {label: "æ­£æ–‡", name: "body", widget: "markdown"}

// =========================
// content/posts/2025-10-18-linux-commands.md  â€”â€” ç¤ºä¾‹æ–‡ç« 
// =========================
---
title: Linux å¸¸ç”¨å‘½ä»¤ä¸é•œåƒåˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰
date: 2025-10-18
tags: ["è¿ç»´"]
views: 55
comments: 1
pinned: true
excerpt: æ”¶å½• Dockerã€Caddy å®‰è£…ã€Swap é…ç½®ã€é•œåƒæºè®¾ç½®ï¼Œä»¥åŠ screen ä¼šè¯ç®¡ç†ç­‰é€ŸæŸ¥æ¸…å•ã€‚
---

è¿™é‡Œå†™æ­£æ–‡å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨ **Markdown**ã€è¡¨æ ¼ã€ä»£ç å—ç­‰ã€‚

// =========================
// README.mdï¼ˆéƒ¨ç½²è¯´æ˜æ‘˜å½•ï¼‰
// =========================
# æŸ³è‹¥æ±çš„å°çªï¼ˆNext.js å¯å‘å¸ƒç‰ˆï¼‰

- **ç¼–è¾‘/åˆ é™¤/æ–°å»ºæ–‡ç« **ï¼šè¿›å…¥ `/admin`ï¼ˆDecap CMSï¼‰ï¼Œç™»å½•åç›´æ¥ç®¡ç† `content/posts/*.md`ã€‚
- **æ–‡ç« è¯¦æƒ…é¡µ**ï¼šè®¿é—® `/posts/[slug]`ã€‚
- **å¯¼èˆªåˆ†é¡µ**ï¼š`/archive` `/albums` `/moments` `/links` `/about` å‡å·²å°±ç»ªã€‚

## æœ¬åœ°è¿è¡Œ
```bash
pnpm i # æˆ– npm i / yarn
pnpm dev
```

## éƒ¨ç½²
- **Vercel**ï¼šä¸€é”®è¿æ¥ GitHub ä»“åº“ï¼›æ„å»ºå‘½ä»¤ `next build`ï¼Œè¾“å‡ºè‡ªåŠ¨ã€‚
- **CMS ç™»å½•**ï¼šconfig.yml ä½¿ç”¨ `github` åç«¯ã€‚éœ€è¦åœ¨ GitHub å»º OAuth App å¹¶åœ¨ä»“åº“è®¾ç½® OAuth å›è°ƒï¼Œæˆ–æ”¹ç”¨ Netlify çš„ git-gatewayï¼ˆæ— éœ€è‡ªå»º OAuthï¼‰ã€‚

## ç”Ÿäº§å»ºè®®
- å°† `uploads/` ç½®äº CDNï¼›è®¾ç½® OG å›¾ä¸ SEOï¼›æ¥å…¥ç»Ÿè®¡ï¼ˆå¦‚ Umamiï¼‰ã€‚
